<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Topic - Tech Blog</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
        overflow-x: hidden;
      }
      .post-item {
        transition: all 0.3s ease;
      }
      .post-item:hover {
        transform: translateX(4px);
      }
      .post-item.locked {
        opacity: 0.5;
        cursor: not-allowed;
      }
      .post-item.completed {
        background: rgba(34, 197, 94, 0.1);
      }
    </style>
  </head>
  <body class="bg-gray-50 text-gray-900">
    <!-- Header -->
    <header class="bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm">
      <div class="container mx-auto px-6 py-3">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3">
            <a href="index.html" class="text-gray-600 hover:text-gray-900 transition-colors" id="topicBackButton">
            </a>
            <script>
              document.getElementById('topicBackButton').innerHTML = SVGIcons.arrowLeft;
            </script>
            <h1 id="topicTitle" class="text-2xl font-bold">
              <!-- Dynamic title -->
            </h1>
          </div>
          <div id="topicProgress" class="text-gray-600 text-sm">
            <!-- Progress -->
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8 max-w-4xl">
      <!-- Topic Info -->
      <section id="topicInfo" class="mb-8">
        <!-- Dynamic content -->
      </section>

      <!-- Progress Bar -->
      <section class="mb-8">
        <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
          <div class="flex items-center justify-between mb-3">
            <h3 class="text-lg font-semibold text-gray-900">ÌïôÏäµ ÏßÑÎèÑ</h3>
            <span id="progressPercentage" class="text-sm text-gray-600">0%</span>
          </div>
          <div class="w-full bg-gray-200 rounded-full h-3">
            <div id="progressBar" class="h-3 rounded-full transition-all duration-500"
                 style="width: 0%"></div>
          </div>
        </div>
      </section>

      <!-- Posts List -->
      <section>
        <h3 class="text-2xl font-bold mb-6 text-gray-900">ÌïôÏäµ Î™©Î°ù</h3>
        <div id="postsList" class="space-y-3">
          <!-- Dynamic posts -->
        </div>
      </section>

      <!-- Navigation Buttons -->
      <section class="mt-12 flex gap-4">
        <button onclick="resetProgress()"
                class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition-colors shadow-sm">
          ÏßÑÎèÑ Ï¥àÍ∏∞Ìôî
        </button>
      </section>
    </main>

    <script src="js/svg-icons.js"></script>
    <script src="js/topics-data.js"></script>
    <script>
      let currentTopic = null;

      // URLÏóêÏÑú ÌÜ†ÌîΩ ID Í∞ÄÏ†∏Ïò§Í∏∞
      function getTopicIdFromURL() {
        const params = new URLSearchParams(window.location.search);
        return params.get('id');
      }

      // ÌÜ†ÌîΩ Îç∞Ïù¥ÌÑ∞ Î°úÎìú
      function loadTopic() {
        const topicId = getTopicIdFromURL();
        currentTopic = topics.find(t => t.id === topicId);

        if (!currentTopic) {
          window.location.href = 'index.html';
          return;
        }

        // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÏóêÏÑú ÏßÑÌñâ ÏÉÅÌô© Î∂àÎü¨Ïò§Í∏∞
        const saved = localStorage.getItem('blogProgress');
        if (saved) {
          const progress = JSON.parse(saved);
          if (progress[currentTopic.id]) {
            currentTopic.completedPosts = progress[currentTopic.id].completed || 0;
            if (progress[currentTopic.id].posts) {
              currentTopic.posts.forEach((post, idx) => {
                post.completed = progress[currentTopic.id].posts[idx] || false;
              });
            }
          }
        }

        renderTopic();
      }

      // ÌÜ†ÌîΩ Î†åÎçîÎßÅ
      function renderTopic() {
        // Title
        document.getElementById('topicTitle').innerHTML = `
          <span class="text-3xl mr-2">${currentTopic.icon}</span>
          <span class="bg-clip-text text-transparent bg-gradient-to-r ${currentTopic.color}">
            ${currentTopic.title}
          </span>
        `;

        // Progress
        const progress = Math.round((currentTopic.completedPosts / currentTopic.totalPosts) * 100);
        document.getElementById('topicProgress').textContent =
          `${currentTopic.completedPosts}/${currentTopic.totalPosts} ÏôÑÎ£å`;

        // Topic Info
        document.getElementById('topicInfo').innerHTML = `
          <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
            <p class="text-gray-600 text-lg">
              ${currentTopic.description}
            </p>
          </div>
        `;

        // Progress Bar
        document.getElementById('progressPercentage').textContent = `${progress}%`;
        const progressBar = document.getElementById('progressBar');
        progressBar.className = `h-3 rounded-full transition-all duration-500 bg-gradient-to-r ${currentTopic.color}`;
        progressBar.style.width = `${progress}%`;

        // Posts List
        renderPosts();
      }

      // Ìè¨Ïä§Ìä∏ Î™©Î°ù Î†åÎçîÎßÅ
      function renderPosts() {
        const container = document.getElementById('postsList');
        let canProceed = true;

        container.innerHTML = currentTopic.posts.map((post, idx) => {
          const isLocked = !canProceed;
          const isCompleted = post.completed;

          if (!isCompleted && canProceed) {
            canProceed = false; // Îã§Ïùå Ìè¨Ïä§Ìä∏Îäî Ïû†Í∏à
          } else if (isCompleted) {
            canProceed = true; // ÏôÑÎ£åÎêú Ìè¨Ïä§Ìä∏ Îã§ÏùåÏùÄ ÏßÑÌñâ Í∞ÄÎä•
          }

          const lockedClass = isLocked ? 'locked' : '';
          const completedClass = isCompleted ? 'completed' : '';
          const cursorClass = isLocked ? 'cursor-not-allowed' : 'cursor-pointer';

          return `
            <div class="post-item ${lockedClass} ${completedClass} bg-white rounded-lg p-5 border border-gray-200 hover:border-blue-300 hover:shadow-md ${cursorClass} transition-all"
                 onclick="${isLocked ? '' : `goToPost(${idx})`}">
              <div class="flex items-start gap-4">
                <!-- Status Icon -->
                <div class="flex-shrink-0 mt-1">
                  ${isCompleted
                    ? `<div class="w-8 h-8 rounded-full bg-green-500 flex items-center justify-center">
                        ${SVGIcons.check}
                       </div>`
                    : isLocked
                      ? `<div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center">
                          ${SVGIcons.lock}
                         </div>`
                      : `<div class="w-8 h-8 rounded-full border-2 border-gray-300 flex items-center justify-center">
                          <span class="text-gray-500 font-bold">${idx + 1}</span>
                         </div>`
                  }
                </div>

                <!-- Content -->
                <div class="flex-1">
                  <h4 class="text-lg font-semibold mb-2 ${isLocked ? 'text-gray-400' : 'text-gray-900'}">
                    ${post.title}
                  </h4>
                  <p class="text-sm ${isLocked ? 'text-gray-400' : 'text-gray-600'}">
                    ${post.description}
                  </p>
                  ${isLocked
                    ? '<p class="text-xs text-yellow-600 mt-2">üîí Ïù¥Ï†Ñ Ìè¨Ïä§Ìä∏Î•º Î®ºÏ†Ä ÏôÑÎ£åÌï¥Ï£ºÏÑ∏Ïöî</p>'
                    : ''}
                </div>

                <!-- Arrow -->
                ${!isLocked
                  ? `<div class="flex-shrink-0">
                      ${SVGIcons.arrowRight}
                     </div>`
                  : ''}
              </div>
            </div>
          `;
        }).join('');
      }

      // Ìè¨Ïä§Ìä∏Î°ú Ïù¥Îèô
      function goToPost(postIndex) {
        window.location.href = `post.html?topic=${currentTopic.id}&post=${postIndex}`;
      }

      // ÏßÑÎèÑ Ï¥àÍ∏∞Ìôî
      function resetProgress() {
        if (confirm('Ï†ïÎßêÎ°ú Ïù¥ ÌÜ†ÌîΩÏùò ÏßÑÎèÑÎ•º Ï¥àÍ∏∞ÌôîÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
          currentTopic.posts.forEach(post => post.completed = false);
          currentTopic.completedPosts = 0;
          saveProgress();
          renderTopic();
        }
      }

      // ÏßÑÌñâ ÏÉÅÌô© Ï†ÄÏû•
      function saveProgress() {
        const saved = localStorage.getItem('blogProgress');
        const progress = saved ? JSON.parse(saved) : {};

        progress[currentTopic.id] = {
          completed: currentTopic.completedPosts,
          posts: currentTopic.posts.map(p => p.completed)
        };

        localStorage.setItem('blogProgress', JSON.stringify(progress));
      }

      // Ï¥àÍ∏∞Ìôî
      loadTopic();
    </script>
  </body>
</html>
