<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Post - Tech Blog</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
        overflow-x: hidden;
      }

      /* Markdown Styles */
      .markdown-content {
        line-height: 1.8;
      }
      .markdown-content h1 {
        font-size: 2.25rem;
        font-weight: bold;
        margin-top: 2rem;
        margin-bottom: 1rem;
        color: #2563eb;
      }
      .markdown-content h2 {
        font-size: 1.875rem;
        font-weight: bold;
        margin-top: 1.75rem;
        margin-bottom: 0.875rem;
        color: #2563eb;
        border-bottom: 2px solid #e5e7eb;
        padding-bottom: 0.5rem;
      }
      .markdown-content h3 {
        font-size: 1.5rem;
        font-weight: bold;
        margin-top: 1.5rem;
        margin-bottom: 0.75rem;
        color: #2563eb;
      }
      .markdown-content h4 {
        font-size: 1.25rem;
        font-weight: bold;
        margin-top: 1.25rem;
        margin-bottom: 0.625rem;
        color: #3b82f6;
      }
      .markdown-content p {
        margin-bottom: 1rem;
        color: #374151;
      }
      .markdown-content ul, .markdown-content ol {
        margin-bottom: 1rem;
        padding-left: 1.5rem;
        color: #374151;
      }
      .markdown-content li {
        margin-bottom: 0.5rem;
      }
      .markdown-content code {
        background-color: #f3f4f6;
        padding: 0.125rem 0.375rem;
        border-radius: 0.25rem;
        font-family: 'Courier New', monospace;
        font-size: 0.875rem;
        color: #dc2626;
        border: 1px solid #e5e7eb;
      }
      .markdown-content pre {
        background-color: #1f2937;
        padding: 1rem;
        border-radius: 0.5rem;
        overflow-x: auto;
        margin-bottom: 1rem;
        border: 1px solid #374151;
      }
      .markdown-content pre code {
        background-color: transparent;
        padding: 0;
        color: #d1d5db;
        border: none;
      }
      .markdown-content blockquote {
        border-left: 4px solid #3b82f6;
        padding-left: 1rem;
        margin: 1rem 0;
        color: #6b7280;
        font-style: italic;
        background-color: #f9fafb;
        padding: 1rem;
        border-radius: 0.25rem;
      }
      .markdown-content a {
        color: #2563eb;
        text-decoration: underline;
      }
      .markdown-content a:hover {
        color: #1d4ed8;
      }
      .markdown-content img {
        max-width: 100%;
        height: auto;
        border-radius: 0.5rem;
        margin: 1rem 0;
        border: 1px solid #e5e7eb;
      }
      .markdown-content table {
        width: 100%;
        border-collapse: collapse;
        margin: 1rem 0;
      }
      .markdown-content th, .markdown-content td {
        border: 1px solid #e5e7eb;
        padding: 0.75rem;
        text-align: left;
      }
      .markdown-content th {
        background-color: #f3f4f6;
        font-weight: bold;
        color: #1f2937;
      }
      .markdown-content hr {
        border: none;
        border-top: 2px solid #e5e7eb;
        margin: 2rem 0;
      }
    </style>
  </head>
  <body class="bg-gray-50 text-gray-900">
    <!-- Header -->
    <header class="bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm">
      <div class="container mx-auto px-6 py-3">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-3">
            <button onclick="goBack()" class="text-gray-600 hover:text-gray-900 transition-colors" id="postBackButton">
            </button>
            <script>
              document.getElementById('postBackButton').innerHTML = SVGIcons.arrowLeft;
            </script>
            <h1 id="postTitle" class="text-xl font-bold text-gray-700">
              <!-- Dynamic title -->
            </h1>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-8 max-w-4xl">
      <!-- Post Header -->
      <section class="mb-8">
        <div class="bg-white rounded-xl p-6 border border-gray-200 shadow-sm">
          <div class="flex items-center gap-2 mb-3">
            <span id="topicIcon" class="text-3xl"></span>
            <span id="topicTitle" class="text-lg text-gray-600"></span>
          </div>
          <h2 id="postMainTitle" class="text-3xl font-bold mb-2 text-gray-900">
            <!-- Post Title -->
          </h2>
          <p id="postDescription" class="text-gray-600">
            <!-- Post Description -->
          </p>
        </div>
      </section>

      <!-- Post Content -->
      <section class="mb-8">
        <article id="postContent" class="markdown-content bg-white rounded-xl p-8 border border-gray-200 shadow-sm">
          <p class="text-gray-600">ì»¨í…ì¸ ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </article>
      </section>

      <!-- Navigation -->
      <section class="flex justify-between items-center gap-4">
        <button id="prevBtn" onclick="goToPrevPost()"
                class="px-6 py-3 bg-white hover:bg-gray-50 border border-gray-300 rounded-lg transition-colors flex items-center gap-2 text-gray-700 shadow-sm">
          <span id="prevIcon"></span>
          <span>ì´ì „ í¬ìŠ¤íŠ¸</span>
        </button>
        <script>
          document.getElementById('prevIcon').innerHTML = SVGIcons.chevronLeft;
        </script>

        <button id="completeBtn" onclick="markAsCompleted()"
                class="px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors font-semibold shadow-sm">
          ì™„ë£Œí•˜ê³  ë‹¤ìŒìœ¼ë¡œ
        </button>

        <button id="nextBtn" onclick="goToNextPost()"
                class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors flex items-center gap-2 shadow-sm">
          <span>ë‹¤ìŒ í¬ìŠ¤íŠ¸</span>
          <span id="nextIcon"></span>
        </button>
        <script>
          document.getElementById('nextIcon').innerHTML = SVGIcons.chevronRight;
        </script>
      </section>
    </main>

    <script src="js/svg-icons.js"></script>
    <script src="js/topics-data.js"></script>
    <script>
      let currentTopic = null;
      let currentPostIndex = null;
      let currentPost = null;

      // URL íŒŒë¼ë¯¸í„° ê°€ì ¸ì˜¤ê¸°
      function getParams() {
        const params = new URLSearchParams(window.location.search);
        return {
          topicId: params.get('topic'),
          postIndex: parseInt(params.get('post'))
        };
      }

      // ë’¤ë¡œ ê°€ê¸°
      function goBack() {
        window.location.href = `topic.html?id=${currentTopic.id}`;
      }

      // í¬ìŠ¤íŠ¸ ë¡œë“œ
      async function loadPost() {
        const { topicId, postIndex } = getParams();

        currentTopic = topics.find(t => t.id === topicId);
        currentPostIndex = postIndex;
        currentPost = currentTopic.posts[currentPostIndex];

        if (!currentTopic || !currentPost) {
          window.location.href = 'index.html';
          return;
        }

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì§„í–‰ ìƒí™© ë¶ˆëŸ¬ì˜¤ê¸°
        const saved = localStorage.getItem('blogProgress');
        if (saved) {
          const progress = JSON.parse(saved);
          if (progress[currentTopic.id] && progress[currentTopic.id].posts) {
            currentPost.completed = progress[currentTopic.id].posts[currentPostIndex] || false;
          }
        }

        renderPost();
        await loadMarkdownContent();
      }

      // í¬ìŠ¤íŠ¸ ë Œë”ë§
      function renderPost() {
        // Header
        document.getElementById('postTitle').textContent = currentPost.title;

        // Post Header
        document.getElementById('topicIcon').textContent = currentTopic.icon;
        document.getElementById('topicTitle').textContent = currentTopic.title;
        document.getElementById('postMainTitle').textContent = currentPost.title;
        document.getElementById('postDescription').textContent = currentPost.description;

        // Navigation Buttons
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const completeBtn = document.getElementById('completeBtn');

        prevBtn.style.display = currentPostIndex > 0 ? 'flex' : 'none';
        nextBtn.style.display = currentPostIndex < currentTopic.posts.length - 1 ? 'flex' : 'none';

        if (currentPost.completed) {
          completeBtn.textContent = 'âœ“ ì™„ë£Œë¨';
          completeBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
          completeBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
        }
      }

      // ë§ˆí¬ë‹¤ìš´ ì½˜í…ì¸  ë¡œë“œ
      async function loadMarkdownContent() {
        try {
          const response = await fetch(`posts/${currentTopic.id}/${currentPost.file}`);

          if (!response.ok) {
            throw new Error('íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
          }

          const markdown = await response.text();
          const html = marked.parse(markdown);
          document.getElementById('postContent').innerHTML = html;
        } catch (error) {
          document.getElementById('postContent').innerHTML = `
            <div class="text-center py-12">
              <p class="text-yellow-600 mb-4">âš ï¸ ì•„ì§ ì‘ì„±ë˜ì§€ ì•Šì€ í¬ìŠ¤íŠ¸ì…ë‹ˆë‹¤</p>
              <p class="text-gray-500">ê³§ ì—…ë°ì´íŠ¸ ì˜ˆì •ì…ë‹ˆë‹¤!</p>
            </div>
          `;
        }
      }

      // ì™„ë£Œ í‘œì‹œ
      function markAsCompleted() {
        if (currentPost.completed) {
          return;
        }

        currentPost.completed = true;

        // ì§„í–‰ ìƒí™© ì €ì¥
        const saved = localStorage.getItem('blogProgress');
        const progress = saved ? JSON.parse(saved) : {};

        if (!progress[currentTopic.id]) {
          progress[currentTopic.id] = {
            completed: 0,
            posts: new Array(currentTopic.posts.length).fill(false)
          };
        }

        progress[currentTopic.id].posts[currentPostIndex] = true;
        progress[currentTopic.id].completed = progress[currentTopic.id].posts.filter(p => p).length;

        localStorage.setItem('blogProgress', JSON.stringify(progress));

        // ë‹¤ìŒ í¬ìŠ¤íŠ¸ë¡œ ì´ë™
        if (currentPostIndex < currentTopic.posts.length - 1) {
          goToNextPost();
        } else {
          alert('ì¶•í•˜í•©ë‹ˆë‹¤! ì´ í† í”½ì˜ ëª¨ë“  í¬ìŠ¤íŠ¸ë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤! ğŸ‰');
          goBack();
        }
      }

      // ì´ì „ í¬ìŠ¤íŠ¸ë¡œ
      function goToPrevPost() {
        if (currentPostIndex > 0) {
          window.location.href = `post.html?topic=${currentTopic.id}&post=${currentPostIndex - 1}`;
        }
      }

      // ë‹¤ìŒ í¬ìŠ¤íŠ¸ë¡œ
      function goToNextPost() {
        if (currentPostIndex < currentTopic.posts.length - 1) {
          window.location.href = `post.html?topic=${currentTopic.id}&post=${currentPostIndex + 1}`;
        }
      }

      // ì´ˆê¸°í™”
      loadPost();
    </script>
  </body>
</html>
